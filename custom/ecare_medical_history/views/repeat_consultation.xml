<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>

        <!-- Explicit tree view -->
        <!--        <record id="repeat_consultation_form_view" model="ir.ui.view">-->
        <!--            <field name="name">repeat.consultation.form.view</field>-->
        <!--            <field name="model">ec.repeat.consultation</field>-->
        <!--            <field name="arch" type="xml">-->
        <!--                <tree>-->

        <!--                </tree>-->
        <!--            </field>-->
        <!--        </record>-->

        <!-- Explicit Kanban View -->

        <record id="view_ec_repeat_consultation_kanban" model="ir.ui.view">
            <field name="name">ec.repeat.consultation.kanban</field>
            <field name="model">ec.repeat.consultation</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile" create="0">
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_global_click">
                                <div class="oe_kanban_title">
                                    <field name="question_one_label"/>
                                    <h5><field name="question_one_choice"/></h5>
                                </div>
                                <div class="oe_kanban_title">
                                    <field name="question_two_label"/>
                                    <h5><field name="question_two_choice"/></h5>
                                </div>
                                <div class="oe_kanban_title">
                                    <field name="question_three_label"/>
                                    <h5><field name="question_three_choice"/></h5>
                                </div>
                                <div class="oe_kanban_title">
                                    <field name="question_four_label"/>
                                </div>
                                <div class="oe_kanban_subtitle">
                                    <field name="repeat_lmp"/>
                                </div>
                                <div class="oe_kanban_footer">
                                    <field name="repeat_state"/>
                                </div>
                                <button name="action_set_working_consultation"
                                        type="object"
                                        string="Edit"
                                        class="btn btn-primary"/>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>


        <!-- Explicit form view -->
        <record id="repeat_consultation_form_view" model="ir.ui.view">
            <field name="name">repeat.consultation.form.view</field>
            <field name="model">ec.repeat.consultation</field>
            <field name="arch" type="xml">
                <form unlink="0" create="0">
                    <div>
                        <field name="repeat_patient_id"
                               style="display:block;"
                               widget="banner_summary_widget"/>
                    </div>
                    <header attrs="{'invisible': [('repeat_state', '!=', '4')]}">
                        <button name="action_open_tvs_form"
                                type="object"
                                class="btn btn-primary"
                                string="TVS"/>
                    </header>
                    <sheet>
                        <field name="repeat_state" invisible="True" force_save="True"/>
                        <!-- Incase group needs to be hidden -->
                        <group >
                            <field name="question_one_label"/>
                            <field name="question_one_choice" widget="radio"/>
                        </group>

                        <group attrs="{'invisible': [('question_one_choice', '=', 'no')]}">
                            <group>
                                <field name="repeat_lmp"/>
                                <field name="repeat_lmp_embryo"/>
                            </group>

                            <!-- TODO -->
                            <group>
                                <i attrs="{'invisible': [('question_one_choice', '=', 'no')]}"> Pregnancy Form details are pending.</i>
                            </group>
                        </group>

                        <group attrs="{'invisible': [('repeat_state', 'in', ['1'])]}">
                            <field name="question_two_label"/>
                            <field name="question_two_choice" widget="radio"/>
                        </group>
                        <group>
                            <button name="action_repeat_consultation_open_obstetrics_history"
                                    attrs="{'invisible': [('question_two_choice', '=', 'no')]}"
                                    type="object"
                                    string="Add Obstetrics History"
                                    class="btn btn-secondary"/>
                        </group>

                        <group attrs="{'invisible': [('repeat_state', 'in', ['1', '2'])]}">
                            <field name="question_three_label"/>
                            <field name="question_three_choice" widget="radio"/>
                        </group>

                        <group>
                            <button name="action_repeat_consultation_open_previous_treatment"
                                    attrs="{'invisible': [('question_three_choice', '=', 'no')]}"
                                    type="object"
                                    string="Add Previous Treatment"
                                    class="btn btn-secondary"/>
                        </group>

                        <group attrs="{'invisible': [('repeat_state', '!=', '4')]}">
                            <field name="question_four_label"/>
                        </group>

                        <group attrs="{'invisible': [('repeat_state', '!=', '4')]}">
                            <field name="repeat_location_id"
                                   options="{'no_create_edit': True, 'no_create': True, 'no_open': True}"/>
                            <field name="repeat_status"/>
                            <field name="repeat_consultation_type"/>
                            <field name="lmp_question_four"/>
                            <field name="repeat_cycle_day"/>
                            <field name="repeat_date"/>
                            <field name="repeat_seen_by"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
                            <field name="repeat_other_doctors_present" widget="many2many_tags"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
                            <field name="repeat_seen_with"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
                            <field name="repeat_notes"/>
                            <field name="repeat_gpe_breast_abdominal_exam"/>
                            <field name="repeat_vaginal_exam"/>
                            <field name="repeat_diagnosis"/>
                            <field name="repeat_advised"/>
                            <field name="repeat_treatment_plan"/>
                            <field name="repeat_procedure_plan"/>
                            <field name="repeat_investigations_ids" widget="many2many_tags"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
                            <field name="repeat_treatment_advised_ids" widget="many2many_tags"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
                        </group>
                        <group attrs="{'invisible': [('repeat_state', '!=', '4')]}">
                                <field name="repeat_ultrasound_type" widget="radio" options="{'horizontal': True}"/>
                        </group>


                        <group attrs="{'invisible': ['|',
                                                     '|',
                                                     '|',
                                                     ('question_one_choice', '=', 'yes'),
                                                     ('question_two_choice', '=', 'yes'), ('question_three_choice', '=', 'yes'),
                                                     ('repeat_state', '=', '4')]}"
                        >
                            <button name="move_back"
                                    type="object"
                                    class="btn btn-secondary"
                                    string="Back"/>

                            <button name="move_next"
                                    type="object"
                                    class="btn btn-secondary"
                                    string="Next"/>
                        </group>

                    </sheet>

                </form>
            </field>
        </record>

        <!-- Explicit Action -->
        <record id="repeat_consultation_action" model="ir.actions.act_window">
            <field name="name">Repeat Consultation</field>
            <field name="res_model">ec.repeat.consultation</field>
            <field name="view_mode">tree,form,kanban</field>
            <field name="target">current</field>
        </record>

    </data>
</odoo>
