<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>

        <!-- Explicit tree view -->
        <!--        <record id="repeat_consultation_form_view" model="ir.ui.view">-->
        <!--            <field name="name">repeat.consultation.form.view</field>-->
        <!--            <field name="model">ec.repeat.consultation</field>-->
        <!--            <field name="arch" type="xml">-->
        <!--                <tree>-->

        <!--                </tree>-->
        <!--            </field>-->
        <!--        </record>-->

        <!-- Explicit Kanban View -->

        <record id="view_ec_repeat_consultation_kanban" model="ir.ui.view">
            <field name="name">ec.repeat.consultation.kanban</field>
            <field name="model">ec.repeat.consultation</field>
            <field name="arch" type="xml">
                <kanban create="0" class="oe_background_grey o_kanban_dashboard o_account_kanban">
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card  w-100 repeat_kanban">
                                <div class="row mr-0 ml-0 p-1">
                                    <div class="col-12 text-center font-weight-bold p-0">
                                        Consultation Date
                                        <b> / </b>
                                        <field name="create_date"/>
                                    </div>
                                </div>
                                <div class="oe_kanban_title">
                                    <field name="question_two_label"/>
                                    <h5><field name="question_two_choice"/></h5>
                                </div>
                                <div class="oe_kanban_title">
                                    <field name="question_three_label"/>
                                    <h5><field name="question_three_choice"/></h5>
                                </div>
                                <div class="oe_kanban_title">
                                    <field name="question_four_label"/>
                                </div>
                                <table t-attf-class="o_group m-0 table_spacing_style">
                                    <tbody>
                                        <tr>
                                            <td class="o_td_label">
                                                <label for="repeat_ultrasound_type" class="o_form_label">Ultrasound</label>
                                            </td>
                                            <td><field name="repeat_ultrasound_type"/></td>
                                            <td class="o_td_label">
                                                <label for="repeat_location_id" class="o_form_label">Location</label>
                                            </td>
                                            <td><field name="repeat_location_id"/></td>
                                        </tr>
                                        <tr>
                                            <td class="o_td_label">
                                                <label for="repeat_status" class="o_form_label">Status</label>
                                            </td>
                                            <td><field name="repeat_status"/></td>
                                            <td class="o_td_label">
                                                <label for="repeat_consultation_type" class="o_form_label">Consultation Type</label>
                                            </td>
                                            <td><field name="repeat_consultation_type"/></td>
                                        </tr>
                                        <tr>
                                            <td class="o_td_label">
                                                <label for="lmp_question_four" class="o_form_label">LMP</label>
                                            </td>
                                            <td><field name="lmp_question_four"/></td>
                                            <td class="o_td_label">
                                                <label for="repeat_cycle_day" class="o_form_label">Cycle Day</label>
                                            </td>
                                            <td><field name="repeat_cycle_day"/></td>
                                        </tr>
                                        <tr>
                                            <td class="o_td_label">
                                                <label for="repeat_date" class="o_form_label">Date</label>
                                            </td>
                                            <td><field name="repeat_date"/></td>
                                            <td class="o_td_label">
                                                <label for="repeat_seen_by" class="o_form_label">Seen by</label>
                                            </td>
                                            <td><field name="repeat_seen_by"/></td>
                                        </tr>
                                        <tr>
                                            <td class="o_td_label">
                                                <label for="repeat_cycle_day" class="o_form_label">Repeat cycle day</label>
                                            </td>
                                            <td><field name="repeat_cycle_day"/></td>
                                            <td class="o_td_label">
                                                <label for="repeat_date" class="o_form_label">Repeat Date</label>
                                            </td>
                                            <td><field name="repeat_date"/></td>
                                        </tr>
                                        <tr>
                                            <td class="o_td_label">
                                                <label for="repeat_seen_by" class="o_form_label">Seen by</label>
                                            </td>
                                            <td><field name="repeat_seen_by"/></td>
<!--                                            <td class="o_td_label">-->
<!--                                                <label for="repeat_other_doctors_present" class="o_form_label">Other Doctors Present</label>-->
<!--                                            </td>-->
<!--                                            <td><field name="repeat_other_doctors_present"/></td>-->
                                        </tr>
                                        <tr>
                                            <td class="o_td_label">
                                                <label for="repeat_seen_with" class="o_form_label">Seen with</label>
                                            </td>
                                            <td><field name="repeat_seen_with"/></td>
                                            <td class="o_td_label">
                                                <label for="repeat_notes" class="o_form_label">Notes</label>
                                            </td>
                                            <td><field name="repeat_notes"/></td>
                                        </tr>
                                        <tr>
                                            <td class="o_td_label">
                                                <label for="repeat_gpe_breast_abdominal_exam" class="o_form_label">GPE / Breast / Abdominal Exam</label>
                                            </td>
                                            <td><field name="repeat_gpe_breast_abdominal_exam"/></td>
                                            <td class="o_td_label">
                                                <label for="repeat_vaginal_exam" class="o_form_label">Vaginal Exam</label>
                                            </td>
                                            <td><field name="repeat_vaginal_exam"/></td>
                                        </tr>

                                        <tr>
                                            <td class="o_td_label">
                                                <label for="repeat_diagnosis" class="o_form_label">Diagnosis</label>
                                            </td>
                                            <td><field name="repeat_diagnosis"/></td>
                                            <td class="o_td_label">
                                                <label for="repeat_advised" class="o_form_label">Advised</label>
                                            </td>
                                            <td><field name="repeat_advised"/></td>
                                        </tr>

                                        <tr>
                                            <td class="o_td_label">
                                                <label for="repeat_treatment_plan" class="o_form_label">Treatment Plan</label>
                                            </td>
                                            <td><field name="repeat_treatment_plan"/></td>
                                            <td class="o_td_label">
                                                <label for="repeat_procedure_plan" class="o_form_label">Procedure Plan</label>
                                            </td>
                                            <td><field name="repeat_procedure_plan"/></td>
                                        </tr>
                                        <tr>
                                            <td class="o_td_label">
                                                <label for="repeat_investigations_ids" class="o_form_label">Investigations</label>
                                            </td>
                                            <td><field name="repeat_investigations_ids"/></td>
                                            <td class="o_td_label">
                                                <label for="repeat_treatment_advised_ids" class="o_form_label">Treatment Advised</label>
                                            </td>
                                            <td><field name="repeat_treatment_advised_ids"/></td>
                                        </tr>
                                    </tbody>
                                </table>

                                <button name="action_open_tvs_form"
                                        type="object"
                                        context="{'default_target': 'new','default_repeat_consultation': 1}"
                                        string="TVS"
                                        class="btn btn-primary repeat_kanban_button"/>

                                <button name="action_set_working_consultation"
                                        type="object"
                                        string="Edit"
                                        class="btn btn-primary repeat_kanban_button"/>
                            </div>
                        </t>

                    </templates>
                </kanban>
            </field>
        </record>


        <!-- Explicit form view -->
        <record id="repeat_consultation_form_view" model="ir.ui.view">
            <field name="name">repeat.consultation.form.view</field>
            <field name="model">ec.repeat.consultation</field>
            <field name="arch" type="xml">
                <form unlink="0" create="0">
                    <div>
                        <field name="repeat_patient_id"
                               style="display:block;"
                               widget="banner_summary_widget"/>
                    </div>
                    <header attrs="{'invisible': [('repeat_state', '!=', '4')]}">
                        <button name="action_open_tvs_form"
                                type="object"
                                class="btn btn-primary"
                                string="TVS"/>
                    </header>
                    <sheet>
                        <field name="repeat_state" invisible="True" force_save="True"/>
                        <!-- Incase group needs to be hidden -->
                        <group>
                            <field name="question_one_label"/>
                            <field name="question_one_choice"
                                   attrs="{'readonly':[('repeat_state','!=','1')]}"
                                   widget="radio"/>
                        </group>

                        <group attrs="{'invisible': [('question_one_choice', '=', 'no')],'readonly':[('repeat_state','!=','1')]}">
                            <group>
                                <field name="repeat_lmp"/>
                                <field name="repeat_lmp_embryo"/>
                            </group>

                            <!-- TODO -->
                            <group>
                                <i attrs="{'invisible': [('question_one_choice', '=', 'no')]}"> Pregnancy Form details are pending.</i>
                            </group>
                        </group>

                        <group attrs="{'invisible': [('repeat_state', 'in', ['1'])]}">
                            <field name="question_two_label"/>
                            <field name="question_two_choice" widget="radio" attrs="{'readonly':[('repeat_state','!=','2')]}"/>
                        </group>
                        <group>
                            <button name="action_repeat_consultation_open_obstetrics_history"
                                    attrs="{'invisible': [('question_two_choice', '=', 'no')]}"
                                    type="object"
                                    string="Add Obstetrics History"
                                    class="btn btn-secondary"/>
                        </group>

                        <group attrs="{'invisible': [('repeat_state', 'in', ['1', '2'])]}">
                            <field name="question_three_label"/>
                            <field name="question_three_choice" widget="radio" attrs="{'readonly':[('repeat_state','!=','3')]}"/>
                        </group>

                        <group>
                            <button name="action_repeat_consultation_open_previous_treatment"
                                    attrs="{'invisible': [('question_three_choice', '=', 'no')]}"
                                    type="object"
                                    string="Add Previous Treatment"
                                    class="btn btn-secondary"/>
                        </group>

                        <group attrs="{'invisible': [('repeat_state', '!=', '4')]}">
                            <field name="question_four_label"/>
                        </group>

                        <group attrs="{'invisible': [('repeat_state', '!=', '4')]}">
                            <field name="repeat_location_id"
                                   options="{'no_create_edit': True, 'no_create': True, 'no_open': True}"/>
                            <field name="repeat_status"/>
                            <field name="repeat_consultation_type"/>
                            <field name="lmp_question_four"/>
                            <field name="repeat_cycle_day"/>
                            <field name="repeat_date"/>
                            <field name="repeat_seen_by"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
<!--                            <field name="repeat_other_doctors_present" widget="many2many_tags"-->
<!--                                   options="{'no_create_edit': True, 'no_create': True}"/>-->
                            <field name="repeat_seen_with"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
                            <field name="repeat_notes"/>
                            <field name="repeat_gpe_breast_abdominal_exam"/>
                            <field name="repeat_vaginal_exam"/>
                            <field name="repeat_diagnosis"/>
                            <field name="repeat_advised"/>
                            <field name="repeat_treatment_plan"/>
                            <field name="repeat_procedure_plan"/>
                            <field name="repeat_investigations_ids" widget="many2many_tags"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
                            <field name="repeat_treatment_advised_ids" widget="many2many_tags"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
                        </group>
                        <group attrs="{'invisible': [('repeat_state', '!=', '4')]}">
                            <field name="repeat_ultrasound_type" widget="radio" options="{'horizontal': True}"/>
                        </group>


                        <group attrs="{'invisible': ['|',
                                                     '|',
                                                     '|',
                                                     ('question_one_choice', '=', 'yes'),
                                                     ('question_two_choice', '=', 'yes'), ('question_three_choice', '=', 'yes'),
                                                     ('repeat_state', '=', '4')]}"
                        >
                            <button name="move_back"
                                    type="object"
                                    class="btn btn-secondary"
                                    string="Back"/>

                            <button name="move_next"
                                    type="object"
                                    class="btn btn-secondary"
                                    string="Next"/>
                        </group>

                    </sheet>

                </form>
            </field>
        </record>

        <!-- Explicit Action -->
        <record id="repeat_consultation_action" model="ir.actions.act_window">
            <field name="name">Repeat Consultation</field>
            <field name="res_model">ec.repeat.consultation</field>
            <field name="view_mode">tree,form,kanban</field>
            <field name="target">current</field>
        </record>

    </data>
</odoo>
